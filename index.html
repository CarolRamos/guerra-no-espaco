<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Guerra no espa&ccedil;o</title>
  </head>
  <body>
  
	<h1>Guerra no espa&ccedil;o</h1>
	
	<table>

	<tr>
		<td>Pontos:</td>
		<td>Fase:</td>
		<td>Vidas:</td>
	</tr>
	<tr>		
		<td colspan=3 ><canvas id="surface" width="640" height="480" style="background-color: #ccc;"></canvas></td>
	</tr>
    

<script type="text/javascript">

window.requestAnimFrame = (function(){
      return  window.requestAnimationFrame       ||
              window.webkitRequestAnimationFrame ||
              window.mozRequestAnimationFrame    ||
              window.oRequestAnimationFrame      ||
              window.msRequestAnimationFrame     ||
              function(/* function */ callback, /* DOMElement */ element){
                window.setTimeout(callback, 1000 / 60);
              };
})();

var canvas = document.getElementById("surface");
var ctx = canvas.getContext("2d");

//Naves
var xJogador = canvas.width/2-20;
var yJogador = canvas.height/2;
var angleJogador = 0;

var xDevagar = 55;
var yDevagar = 10;
var angleDevagar = 0;

var xDevagarAtira = 160;
var yDevagarAtira = 10;
var angleDevagarAtira = 0;

var xRapidoAtira = 265;
var yRapidoAtira = 10;
var angleRapidoAtira = 0;

var planeImage = new Image();
planeImage.src = "red-airplane.png";

planeImage.addEventListener("load", function() {
	function desenha() {
		ctx.save();
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		for (x = 0; x <=canvas.width; x += 35) {
			for (y = 0; y <=canvas.height; y += 50) {					
				ctx.fillRect(x, y, 5, 20);	
			}
		}
		ctx.restore();
	}
	
	var Nave = {
			jogador:function(xJogador, yJogador, angleJogador) {
				ctx.save();
				ctx.translate(xJogador,yJogador);
				ctx.rotate(angleJogador * Math.PI/180);
				ctx.drawImage(planeImage, 0, 0, 26, 25, -13, -13, 25, 26);
				ctx.restore();
			},
			devagar:function() {
				ctx.save();
				ctx.translate(xDevagar,yDevagar);
				ctx.rotate(angleDevagar * Math.PI/180);
				ctx.drawImage(planeImage, 52, 0, 26, 25, -13, -13, 25, 26);
				ctx.restore();
			},
			devagarAtira:function() {
				ctx.save();
				ctx.translate(xDevagarAtira,yDevagarAtira);
				ctx.rotate(angleDevagarAtira * Math.PI/180);
				ctx.drawImage(planeImage, 78, 0, 26, 25, -13, -13, 25, 26);
				ctx.restore();
			},
			rapidoAtira:function() {
				ctx.save();
				ctx.translate(xRapidoAtira,yRapidoAtira);
				ctx.rotate(angleRapidoAtira * Math.PI/180);
				ctx.drawImage(planeImage, 26, 0, 26, 25, -13, -13, 25, 26);
				ctx.restore();
			}
	}
	
	
	window.addEventListener("keydown", function(e) {
		if (e.keyCode == 38){ //seta cima
			//Detecta se irá passar da area do canvas
			if(yJogador-movimentoNormal >= 15) {
				yJogador -= movimentoNormal;
				angleJogador = 0;
				Nave.jogador(xJogador,yJogador,angleJogador);
			} 
			
		}
		if (e.keyCode == 40){ //seta baixo
			//Detecta se irá passar da area do canvas
			if(yJogador+movimentoNormal <= canvas.height-15) {
				angleJogador = 180;
				yJogador += movimentoNormal;
				Nave.jogador(xJogador,yJogador,angleJogador);
			}
		}
		
		if(e.keyCode == 37) { //seta esquerda
			//Detecta se irá passar da area do canvas
			if(xJogador-movimentoNormal >= 15) {
				angleJogador = 270;
				xJogador -= movimentoNormal;
				Nave.jogador(xJogador,yJogador,angleJogador);
			}
			
		}
		if(e.keyCode == 39) { //seta direita
			if(xJogador+movimentoNormal <= canvas.width-15) {
				angleJogador = 90;
				xJogador  += movimentoNormal;
				Nave.jogador(xJogador,yJogador,angleJogador);
			}
			
		}

	});
	
	function loop() {
	  desenha();
	  Nave.jogador(xJogador, yJogador, angleJogador);
	  Nave.devagar(xDevagar, yDevagar, angleDevagar);
	  Nave.devagarAtira(xDevagarAtira, yDevagarAtira, angleDevagar);
	  Nave.rapidoAtira(xRapidoAtira, yRapidoAtira, angleRapidoAtira);
	  window.requestAnimFrame(loop, canvas);
	} 
	
			
	window.requestAnimFrame(loop(), canvas);
});
	
</script>
  </body>
</html>