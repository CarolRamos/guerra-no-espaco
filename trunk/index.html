<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Guerra no espa&ccedil;o</title>
  </head>
  <body>
  
	<h1>Guerra no espa&ccedil;o</h1>
	
	<table>

	<tr>
		<td>Pontos:</td>
		<td>Fase:</td>
		<td>Vidas:</td>
	</tr>
	<tr>		
		<td colspan=3 ><canvas id="surface" width="640" height="480" style="background-color: #ccc;"></canvas></td>
	</tr>
    

<script type="text/javascript">

window.requestAnimFrame = (function(){
      return  window.requestAnimationFrame       ||
              window.webkitRequestAnimationFrame ||
              window.mozRequestAnimationFrame    ||
              window.oRequestAnimationFrame      ||
              window.msRequestAnimationFrame     ||
              function(/* function */ callback, /* DOMElement */ element){
                window.setTimeout(callback, 1000 / 60);
              };
})();

var canvas = document.getElementById("surface");
var ctx = canvas.getContext("2d");


//Naves
var navesInimigas = new Array("Devagar", "DevagarAtira", "RapidoAtira");

var xJogador = canvas.width/2-23;
var yJogador = canvas.height/2;
var angleJogador = 0;

var xDevagar = 297;
var yDevagar = 380;
var angleDevagar = 0;


var xDevagarAtira = 140;
var yDevagarAtira = 350;
var angleDevagarAtira = 0;


var xRapidoAtira = 255;
var yRapidoAtira = 330;
var angleRapidoAtira = 0;

//Velocidades 
var movimentoDevagar = 2;
var movimentoNormal = 4;
var movimentoRapido = 6;
var movimentoTiro = 5;

//ColisÃ£o
var distanciaColisao = 28;

var mapaX = new Array();
var mapaY = new Array();


var i = 0;

for (x = 0; x <=canvas.width; x += 39) {
	mapaX[i] = x;
	i++;
}
i = 0;
for (y = 0; y <=canvas.height; y += 50) {					
	mapaY[i] = y;
	i++;
}
		


var planeImage = new Image();
planeImage.src = "red-airplane.png";

planeImage.addEventListener("load", desenha());
	
function desenha() {
		ctx.save();
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		for (x = 0; x < mapaX.length; x += 1) {
			for (y = 0; y < mapaY.length; y += 1) {					
				ctx.fillRect(mapaX[x], mapaY[y], 5, 20);	
			}
		}
		ctx.restore();
	}
	
	var Nave = {
			jogador:function(xJogador, yJogador, angleJogador) {
				ctx.save();
				ctx.translate(xJogador,yJogador);
				ctx.rotate(angleJogador * Math.PI/180);
				ctx.drawImage(planeImage, 0, 0, 26, 25, -13, -13, 25, 26);
				ctx.restore();
			},
			devagar:function() {
				ctx.save();
				ctx.translate(xDevagar,yDevagar);
				ctx.rotate(angleDevagar * Math.PI/180);
				ctx.drawImage(planeImage, 52, 0, 26, 25, -13, -13, 25, 26);
				ctx.restore();
			},
			devagarAtira:function() {
				ctx.save();
				ctx.translate(xDevagarAtira,yDevagarAtira);
				ctx.rotate(angleDevagarAtira * Math.PI/180);
				ctx.drawImage(planeImage, 78, 0, 26, 25, -13, -13, 25, 26);
				ctx.restore();
			},
			rapidoAtira:function() {
				ctx.save();
				ctx.translate(xRapidoAtira,yRapidoAtira);
				ctx.rotate(angleRapidoAtira * Math.PI/180);
				ctx.drawImage(planeImage, 26, 0, 26, 25, -13, -13, 25, 26);
				ctx.restore();
			}
	}
	
	
	function colidiuX(nave){
		var colidiu = false;
			for ( i = 0; i < mapaX.length; i++ ){
				if( eval("x"+nave) >= (mapaX[i] -13) & eval("x"+nave) <= (mapaX[i] + 18)){					
					colidiu = true;
				}
			}
		return colidiu;
	}
	
	function colidiuY(nave){
		var colidiu = false;
			for ( i = 0; i < mapaY.length; i++ ){
				if ( eval("y"+nave) >= (mapaY[i] -13) & eval("y"+nave) <= (mapaY[i] + 33)){				
					colidiu = true;
				}
			}
		return colidiu;
	}
	
	function colidiuInimigo(){
		var colidiuInimigo = false;
		
		for(var i=0; i<navesInimigas.length; i++) {
			if((xJogador+distanciaColisao >= eval("x"+navesInimigas[i]) && xJogador-distanciaColisao <= eval("x"+navesInimigas[i])) && (yJogador+distanciaColisao >= eval("y"+navesInimigas[i]) && yJogador-distanciaColisao <=eval("y"+navesInimigas[i]))) {
				colidiuInimigo = true;
			}
		}
		
		if(colidiuInimigo) {
			alert("Game-Over");
		}		
	}
	
	
	window.addEventListener("keydown", function(e) {
		if (e.keyCode == 38){ //seta cima
			if (!colidiuX("Jogador")){
				if(yJogador-movimentoNormal >= 15) {
					yJogador -= movimentoNormal;
					angleJogador = 0;
					Nave.jogador(xJogador,yJogador,angleJogador);
				} 
			}			
		}
		if (e.keyCode == 40){ //seta baixo				
			if (!colidiuX("Jogador")){
				//Detecta se irÃ¡ passar da area do canvas
				if(yJogador+movimentoNormal <= canvas.height-15) {
					angleJogador = 180;
					yJogador += movimentoNormal;
					Nave.jogador(xJogador,yJogador,angleJogador);
				}
			}
		}
		
		if(e.keyCode == 37) { //seta esquerda
			if (!colidiuY("Jogador")){
				//Detecta se irÃ¡ passar da area do canvas
				if(xJogador-movimentoNormal >= 15) {
					angleJogador = 270;
					xJogador -= movimentoNormal;
					Nave.jogador(xJogador,yJogador,angleJogador);
				}
			}
			
		}
		if(e.keyCode == 39) { //seta direita
			if (!colidiuY("Jogador")){
				if(xJogador+movimentoNormal <= canvas.width-15) {
					angleJogador = 90;
					xJogador  += movimentoNormal;
					Nave.jogador(xJogador,yJogador,angleJogador);
				}
			}
			
		}
	});
	
	function movimentoInimigo() {
		if(colidiuInimigo) {
			yDevagar -= movimentoDevagar;
			yDevagarAtira -= movimentoDevagar;
			yRapidoAtira -= movimentoRapido;
		}
	}
	
	function loop() {
	  desenha();
	  movimentoInimigo();
	  colidiuInimigo();
	  Nave.jogador(xJogador, yJogador, angleJogador);
	  Nave.devagar(xDevagar, yDevagar, angleDevagar);
	  Nave.devagarAtira(xDevagarAtira, yDevagarAtira, angleDevagar);
	  Nave.rapidoAtira(xRapidoAtira, yRapidoAtira, angleRapidoAtira);
	  window.requestAnimFrame(loop, canvas);
	} 
	
			
	window.requestAnimFrame(loop, canvas);

	
</script>
  </body>
</html>